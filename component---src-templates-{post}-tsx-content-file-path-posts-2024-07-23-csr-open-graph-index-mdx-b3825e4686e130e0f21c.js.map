{"version":3,"file":"component---src-templates-{post}-tsx-content-file-path-posts-2024-07-23-csr-open-graph-index-mdx-b3825e4686e130e0f21c.js","mappings":"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","sources":["webpack://hans-blog/./posts/2024/07-23-csr-open-graph/index.mdx","webpack://hans-blog/./src/templates/{post}.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    h2: \"h2\",\n    span: \"span\",\n    strong: \"strong\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    del: \"del\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\",\n    ol: \"ol\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"최근 회사에서 가볍고 빠른 성능의 사이트가 필요하다는 요구가 있어 Vite와 Svelte로 SPA를 개발하게 되었습니다. 동적 라우팅이 필요했고, 경로에 따라 백오피스에서 설정한 커스텀 페이지를 보여주는 사이트였습니다.\"), \"\\n\", React.createElement(_components.p, null, \"문제는 동적 경로에 따라 OG 메타태그를 적용해야 한다는 사실이었습니다. 취업 준비를 하던 시절 \\\"CSR = SEO가 불가능\\\"이라고 거의 공식처럼 암기했기 때문에, 저는 당연히 불가능한 일이라고 생각했습니다.\"), \"\\n\", React.createElement(_components.p, null, \"하지만 뜻밖에도 \", React.createElement(_components.a, {\n    href: \"https://techblog.woowahan.com/15469/\"\n  }, \"이 문제를 해결한 포스팅\"), \"을 알게 되었고, 이를 참고해 무사히 해결할 수 있었습니다. (감사합니다!) 비슷한 고민이 있는 분들은 해당 포스팅이 큰 도움이 되리라 생각합니다.\"), \"\\n\", React.createElement(_components.p, null, \"전반적인 해결 방법은 위 포스팅을 통해서도 충분히 얻을 수 있었지만, 그럼에도 겪은 문제들과 이를 통해 알게 된 내용들을 정리했습니다.\"), \"\\n\", React.createElement(_components.h2, null, \"CSR에서 동적 OG 메타태그를 적용하는 방법\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 545px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/662b513ecb452b1df4d7a26cca47235c/d2d42/cloudfront-events-that-trigger-lambda-functions.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABgUlEQVR42jVRXUvCYBTeP+q2/9JddBV1EXQRBUU33YZBQVD0QSwvsgL70FkmqWk5E9y71Olw06kscWmuze396tXo4eHAOc95OIdzOEIInYBADw77GFOMxrW/eg+8p5bmusnHse46TCV4LJAJONaBEMSUDk21HD/+qAFJzmUKD+63Sc1S++4kszDTCh11QbT4HFK0ysubUNWLdOLnHMdxXYcl9ZYcFU9jr0dC9jBwPlsReWoUfDVjCbwPHjMv+5HswZN4dna/zkc2JKkoinlOURQAAIu2PSQ/PYIg28q3e0TLmQWB0SoneyCBamlkNdgMH45YDAaDO4EAV5SkSrnct92vUlzenNL5ReNypcnP9xN7/VK6WxAYLTlpnM59bE0b16vGxfJneC31cBMRYtz3YNDptD1EfKujh7frCmhU5XpFslWRalmi54j+xva381fa7W5TU3VFamkKszQNg6P/wAiikQMRgQj7CGPoY7MKtRwj6qrEc9i1Rx50R57r+X+/+AWxlWmomzV4EQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <picture>\\n          <source\\n              srcset=\\\"/static/662b513ecb452b1df4d7a26cca47235c/89b46/cloudfront-events-that-trigger-lambda-functions.webp 180w,\\n/static/662b513ecb452b1df4d7a26cca47235c/97ead/cloudfront-events-that-trigger-lambda-functions.webp 360w,\\n/static/662b513ecb452b1df4d7a26cca47235c/21895/cloudfront-events-that-trigger-lambda-functions.webp 545w\\\"\\n              sizes=\\\"(max-width: 545px) 100vw, 545px\\\"\\n              type=\\\"image/webp\\\"\\n            />\\n          <source\\n            srcset=\\\"/static/662b513ecb452b1df4d7a26cca47235c/96042/cloudfront-events-that-trigger-lambda-functions.png 180w,\\n/static/662b513ecb452b1df4d7a26cca47235c/7a322/cloudfront-events-that-trigger-lambda-functions.png 360w,\\n/static/662b513ecb452b1df4d7a26cca47235c/d2d42/cloudfront-events-that-trigger-lambda-functions.png 545w\\\"\\n            sizes=\\\"(max-width: 545px) 100vw, 545px\\\"\\n            type=\\\"image/png\\\"\\n          />\\n          <img\\n            class=\\\"gatsby-resp-image-image\\\"\\n            src=\\\"/static/662b513ecb452b1df4d7a26cca47235c/d2d42/cloudfront-events-that-trigger-lambda-functions.png\\\"\\n            alt=\\\"cloudfront-events-that-trigger-lambda-functions.png\\\"\\n            title=\\\"\\\"\\n            loading=\\\"lazy\\\"\\n            decoding=\\\"async\\\"\\n            style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n          />\\n        </picture>\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(\"span\", {\n    style: {\n      textAlign: 'center',\n      margin: '0 auto',\n      fontStyle: 'italic',\n      color: 'var(--color-text-footer)'\n    }\n  }, \"출처: \", React.createElement(_components.a, {\n    href: \"https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/lambda-cloudfront-trigger-events.html\"\n  }, \"AWS 공식문서\")), \"\\n\", React.createElement(_components.p, null, \"AWS CloudFront에서는 위와 같은 네 구간에 엣지 함수를 설정할 수 있습니다.\"), \"\\n\", React.createElement(_components.p, null, \"방법을 요약하면 Viewer request 이벤트에 엣지 함수를 설정해서, 요청자가 봇인지 아닌지를 판별해 봇일 경우 \", React.createElement(_components.strong, null, \"OG 메타태그만을 포함한 HTML\"), \"을 생성하여 응답으로 보내는 것입니다.\"), \"\\n\", React.createElement(_components.p, null, \"즉 봇에 의한 요청일 경우 Viewer request 단계에서 바로 응답을 생성하여 OG 메타태그 HTML을 응답으로 보내고, 그 이외에 실사용자에 의한 요청일 경우 정상적으로 CloudFront 원본(제 경우에는 S3)을 거쳐 응답을 보냅니다.\"), \"\\n\", React.createElement(_components.p, null, \"주의할 점은 만약 클라이언트 사이드 라우팅 방식이 hash property 기반일 경우에는 위 방식이 불가능하다는 것입니다. hash property는 서버로 전달되지 않기 때문에, 어떤 페이지를 요청하든 CloudFront 측에서는 동일한 페이지로 간주합니다. 이로 인해 페이지별로 적절한 OG 태그를 생성하는 것이 어렵습니다.\"), \"\\n\", React.createElement(_components.p, null, \"저 역시 위와 같은 이슈로 인해 라우팅 라이브러리를 변경해야 했습니다.\"), \"\\n\", React.createElement(_components.h2, null, React.createElement(_components.strong, null, \"CloudFront Functions\"), \" vs \", React.createElement(_components.strong, null, \"Lambda@Edge\")), \"\\n\", React.createElement(_components.p, null, \"둘의 차이는 위 포스팅에 잘 요약되어 있고, \", React.createElement(_components.a, {\n    href: \"https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/edge-functions-choosing.html\"\n  }, \"공식 문서\"), \"에서 좀더 상세한 내용을 확인할 수 있습니다.\"), \"\\n\", React.createElement(_components.p, null, \"제가 고려한 차이점은 다음과 같습니다.\"), \"\\n\", React.createElement(_components.table, null, React.createElement(_components.thead, null, React.createElement(_components.tr, null, React.createElement(_components.th, {\n    align: \"center\"\n  }), React.createElement(_components.th, null, \"CloudFront Functions\"), React.createElement(_components.th, null, \"Lambda@Edge\"))), React.createElement(_components.tbody, null, React.createElement(_components.tr, null, React.createElement(_components.td, {\n    align: \"center\"\n  }, \"특징\"), React.createElement(_components.td, null, \"간단한 작업에 적합\"), React.createElement(_components.td, null, \"복잡한 작업 가능\")), React.createElement(_components.tr, null, React.createElement(_components.td, {\n    align: \"center\"\n  }, \"적용 가능한 이벤트\"), React.createElement(_components.td, null, \"Viewer request/response\"), React.createElement(_components.td, null, \"Viewer request/response,\", React.createElement(\"br\"), \"Origin request/response\")), React.createElement(_components.tr, null, React.createElement(_components.td, {\n    align: \"center\"\n  }, \"네트워크 통신\"), React.createElement(_components.td, null, \"X\"), React.createElement(_components.td, null, \"O\")), React.createElement(_components.tr, null, React.createElement(_components.td, {\n    align: \"center\"\n  }, \"외부 라이브러리 사용\"), React.createElement(_components.td, null, \"X\"), React.createElement(_components.td, null, \"O\")), React.createElement(_components.tr, null, React.createElement(_components.td, {\n    align: \"center\"\n  }, \"비용\"), React.createElement(_components.td, null, \"요청당 비용 청구\"), React.createElement(_components.td, null, \"요청 및 함수 지속 시간당\", React.createElement(\"br\"), \"비용 청구\")))), \"\\n\", React.createElement(_components.p, null, \"제 경우에는 OG 태그 생성을 위해 API 콜이 필수적이었으므로 Lambda@Edge 외엔 선택지가 없었습니다.\"), \"\\n\", React.createElement(_components.h2, null, React.createElement(_components.del, null, \"람다 계층 사용\")), \"\\n\", React.createElement(_components.p, null, \"처음에는 Fetch API를 사용해 API 콜을 하려 했지만, \", React.createElement(_components.code, null, \"fetch\"), \" 함수가 존재하지 않는다는 에러를 만났습니다. 람다 함수는 노드 환경이고 Fetch API는 웹 브라우저가 제공하는 API이기 때문입니다.\"), \"\\n\", React.createElement(_components.p, null, \"저는 그 대안으로서 Aixos를 사용하고자 했습니다. Axios의 기반이 되는 XHR 역시 브라우저 API지만, Axios는 서버 사이드에서도 동작하는 라이브러리인 만큼 노드 환경에 필요한 dependency가 갖춰져 있을 거라 생각했습니다.\"), \"\\n\", React.createElement(_components.p, null, \"람다 함수에서 외부 라이브러리를 사용하는 방법은 크게 두 가지였습니다.\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"\\n\", React.createElement(_components.p, null, \"외부 라이브러리를 포함하는 .zip 파일을 생성해 업로드한다.\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, \"람다 계층(Lambda layer)\"), \" 을 추가한다.\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"람다 계층이란 람다 함수와 별도로 외부 종속성을 관리하기 위한 기능입니다. 즉 저 두 가지 방식은 라이브러리 코드를 하나의 람다 함수 패키지에 전부 집어넣느냐, 아니면 따로 분리해서 관리하느냐 차이입니다.\"), \"\\n\", React.createElement(_components.p, null, \"람다 계층을 사용하면 하나의 종속성을 여러 람다 함수에서 재사용 가능하기 때문에, 종속성을 추가할 때 일반적으로 권장하는 방법이었습니다. 따라서 저도 이 방법을 택했습니다.\"), \"\\n\", React.createElement(_components.p, null, \"계층을 구성하는 방법은 간단한데, 우선 아래와 같은 형태로 구성되도록 .zip 파일을 만든 후 AWS 콘솔에서 람다 계층을 추가할 때 업로드하면 됩니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"text\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">axios-layer.zip\\n└ nodejs\\n  └ axios\\n    └ ...</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"람다 함수의 런타임 버전이 계층의 호환 런타임 버전에 포함되어야 한다는 점만 주의하면 계층 생성에서 크게 어려운 점은 없었습니다.\"), \"\\n\", React.createElement(_components.p, null, \"저는 Axios 종속성을 위한 계층을 생성하고 이를 람다 함수에 추가했습니다. 그리고 \", React.createElement(_components.strong, null, \"Lambda@Edge에는 계층 사용이 불가능하다\"), \"는 사실을 뒤늦게 알게 되었습니다. (\", React.createElement(_components.a, {\n    href: \"https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/lambda-at-edge-function-restrictions.html#lambda-at-edge-restrictions-features\"\n  }), \")\"), \"\\n\", React.createElement(_components.h2, null, \"네트워크 통신, 그리고 해결\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://nodejs.org/api/https.html\"\n  }, \"노드의 HTTPS 모듈\"), \"을 사용해 API 콜을 할 수 있었습니다. Lambda@Edge 문서의 함수 예제에는 없는 내용이라 구글링을 하던 중 한 AWS 포스팅에서 해당 내용을 찾게 되었습니다. (\", React.createElement(_components.a, {\n    href: \"https://aws.amazon.com/ko/blogs/networking-and-content-delivery/leveraging-external-data-in-lambdaedge/\"\n  }), \")\"), \"\\n\", React.createElement(_components.p, null, \"HTTPS 모듈은 사용 방법이 조금 복잡해서, 아래와 같이 한번 래핑해서 사용했습니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"javascript\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fetchData</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">url</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    https\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>url<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">res</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setEncoding</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'utf8'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n        <span class=\\\"token keyword\\\">let</span> rawData <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">''</span><span class=\\\"token punctuation\\\">;</span>\\n\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'data'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">chunk</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n          rawData <span class=\\\"token operator\\\">+=</span> chunk<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toString</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'end'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">const</span> parsedData <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parse</span><span class=\\\"token punctuation\\\">(</span>rawData<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>parsedData<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">error</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          <span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'error'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">error</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"또한 함수가 잘 동작하는지 확인하기 위해 주기적으로 테스트를 해가며 함수를 작성할 필요가 있었는데, 저는 다음과 같은 과정을 거쳐 테스트 데이터를 구했습니다.\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/lambda-event-structure.html\"\n  }, \"Lambda@Edge 이벤트 구조\"), \" 문서에서 일반적인 Viewer request 이벤트를 구해 테스트하고, 기본적인 함수를 구성합니다.\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://docs.aws.amazon.com/ko_kr/AmazonCloudFront/latest/DeveloperGuide/lambda-examples.html#lambda-examples-generated-response-examples\"\n  }, \"함수 예제\"), \"를 참고하여 Viewer request에서 바로 응답을 생성하는 함수를 작성합니다. 이때, response body는 \", React.createElement(_components.code, null, \"handler\"), \" 함수의 \", React.createElement(_components.code, null, \"event\"), \" 파라미터를 \", React.createElement(_components.code, null, \"JSON.stringify()\"), \"로 처리한 값을 넣습니다.\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"\\n\", React.createElement(_components.p, null, \"웹사이트의 CloudFront에 람다 함수를 연결합니다. 웹사이트에 접속하면 실제 Viewer request 이벤트를 본문으로 얻을 수 있습니다.\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"위와 같은 과정을 거쳐 테스트 데이터를 얻고, 무사히 원하는 기능을 구현할 수 있었습니다.\"), \"\\n\", React.createElement(_components.h2, null, \"마치며\"), \"\\n\", React.createElement(_components.p, null, \"처음에는 당연히 불가능하다고 생각한 일이었고 실제로 프론트엔드 코드 상에서 해결하기는 힘든 이슈였습니다. 그러나 인프라를 통해 해결할 수 있었고, 이러한 경험을 얻은 것을 행운이라 생각합니다.\"), \"\\n\", React.createElement(_components.p, null, \"문제를 해결하기 위한 시야가 한층 더 넓어진 한편, 좁은 상식을 근거로 불가능하다고 단정지었던 제 자신을 반성할 수 있는 기회였습니다.\"), \"\\n\", React.createElement(_components.p, null, \"마지막으로 이 문제를 해결하는 데 도움을 준 모든 자료와 포스팅에 감사드리며, 이 글이 비슷한 고민을 하는 분들께 유용한 참고자료가 되기를 바랍니다.\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/Users/hans/Developer/ToyProject/bluewood-truth.github.io/posts/2024/07-23-csr-open-graph/index.mdx\";\nimport React from 'react';\nimport {routes} from 'src/_common/constants/routes';\nimport {SEO} from 'src/components/seo';\nimport {Layout} from 'src/views/layout';\nimport {PostLayout} from 'src/views/post-layout';\nimport {jsx as ___EmotionJSX} from \"@emotion/react\";\nconst pageQuery = \"3375554023\";\nexport const Head = _ref => {\n  let {data} = _ref;\n  return ___EmotionJSX(SEO, {\n    title: data.mdx.frontmatter.title\n  });\n};\nconst PostPage = _ref2 => {\n  var _location$state$refer, _location$state;\n  let {data: {mdx}, location, children} = _ref2;\n  return ___EmotionJSX(Layout, null, ___EmotionJSX(PostLayout, {\n    backUrl: (_location$state$refer = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.referrer) !== null && _location$state$refer !== void 0 ? _location$state$refer : routes.home,\n    post: mdx\n  }, children));\n};\nPostPage\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostPage, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","a","h2","span","strong","table","thead","tr","th","tbody","td","del","code","ul","li","ol","_provideComponents","components","React","href","dangerouslySetInnerHTML","__html","style","textAlign","margin","fontStyle","color","align","wrapper","MDXLayout","Head","_ref","data","___EmotionJSX","SEO","title","mdx","frontmatter","PostPage","_ref2","_location$state$refer","_location$state","location","children","Layout","PostLayout","backUrl","state","referrer","routes","home","post","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}